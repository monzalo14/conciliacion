---
title: "Calibración de Random Forest para Modelos de Probabilidad"
author: "Mónica Zamudio"
date: "29 de marzo de 2017"
output: html_document
---





Usamos la metodología *SMOTE* para tener un dataset balanceado (vamos a sobrerrepresentar algunos casos ganadores y subrepresentar algunos casos perdedores):


```
## WARNING: NAs generated by SMOTE removed
```

```
## WARNING: NAs generated by SMOTE removed
```

Dividimos la muestra expandida en dos poblaciones: entrenamiento y prueba.


```r
set.seed(140693)
smp_size <- floor(0.80 * nrow(X))
train_ind <- sample(seq_len(nrow(X)), size = smp_size, replace = FALSE)
X_train <- X[train_ind, ]
X_test  <- X[-train_ind, ]
Y_train <- Y[train_ind]
Y_test  <- Y[-train_ind]

X_rm_train <- X_rm[train_ind, ]
X_rm_test  <- X_rm[-train_ind, ]
```

Calibramos dos Random Forest, uno con la variable de renuncia voluntaria y otro sin la variable.


```r
RF <- tune.randomForest(X_train, Y_train, ntree = c(900, 1000, 1100, 1200, 1300, 1400, 1500))
summary(RF)
```

```
## 
## Parameter tuning of 'randomForest':
## 
## - sampling method: 10-fold cross validation 
## 
## - best parameters:
##  ntree
##   1300
## 
## - best performance: 0.1806878 
## 
## - Detailed performance results:
##   ntree     error dispersion
## 1   900 0.1955026 0.04248300
## 2  1000 0.1880952 0.07044139
## 3  1100 0.1843915 0.05999131
## 4  1200 0.1917989 0.06682477
## 5  1300 0.1806878 0.04359598
## 6  1400 0.1955026 0.06275848
## 7  1500 0.1806878 0.05852151
```

Ahora, usamos el conjunto de prueba para comprobar la capacidad de generalización de nuestro modelo:

```r
set.seed(140693)
RF_best <- randomForest(X_train, Y_train, ntree = RF$best.parameters[[1]])
prediccion_RF <- predict(RF_best, X_test)
```

Para este modelo, tenemos entonces una tasa de error de 0.1617647%.

Va la lista de variables que usa el RF:

```r
names(X)
```

```
##  [1] "reclutamiento"       "gen"                 "antig"              
##  [4] "reinst"              "hextra"              "sarimssinf"         
##  [7] "horas_sem"           "hextra_sem"          "rec20"              
## [10] "prima_dom"           "desc_sem"            "desc_ob"            
## [13] "c_indem"             "min_ley"             "giro_empresa00"     
## [16] "giro_empresa31"      "giro_empresa43"      "giro_empresa46"     
## [19] "giro_empresa52"      "giro_empresa54"      "giro_empresa56"     
## [22] "giro_empresa61"      "giro_empresa62"      "giro_empresa72"     
## [25] "giro_empresa81"      "renuncia_voluntaria"
```

```r
save(RF_best, file = 'probabilidad_laudo.RData')
```
